@model IEnumerable<MvcMovie.Models.User>
@{
    ViewBag.Title = "UsersManage";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
<script src="~/Content/js/plugins/sweetalert/sweetalert.min.js"></script>

@using (Html.BeginForm())
{
<div class="col-lg-12">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>您的待办事务列表</h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="dropdown-toggle" data-toggle="dropdown" href="table_data_tables.html#">
                    <i class="fa fa-wrench"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li>
                        <a href="table_data_tables.html#">Config option 1</a>
                    </li>
                    <li>
                        <a href="table_data_tables.html#">Config option 2</a>
                    </li>
                </ul>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        
        <div class="ibox-content">
            <div class="">
                <a href="/Page2/UserCreate" class="btn btn-primary ">添加用户</a>
            </div>
            <div id="editable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">

                <div class="row">

                    <div class="form-group col-sm-3">
                        <label for="exampleInputName2">用户名称:</label>
                        <input type="text" class="form-control" id="exampleInputName2" placeholder="输入任务名称">
                    </div>
                    <div class="form-group col-sm-3">
                        <div class="dataTables_length" id="editable_length">
                            <label>
                                用户角色: @Html.DropDownList("RID", null, htmlAttributes: new { @class = "form-control" })
                            </label>
                        </div>
                    </div>

                    <div class="form-group col-sm-3">
                        <div class="dataTables_length" id="editable_length">
                            <label>
                                所属部门: @Html.DropDownList("DID", null, htmlAttributes: new { @class = "form-control" })
                             
                            </label>
                        </div>
                    </div>


                    <div class="form-group col-sm-3 ">
                        <button type="button" class="btn btn-w-m btn-info" onclick="iop()">查询</button>
                    </div>

                </div><div class="row">
                    <div class="col-sm-12">
                        <table class="table table-striped table-bordered table-hover  dataTable" id="editable" role="grid" aria-describedby="editable_info">
                            <thead>
                                <tr role="row">
                                    <th class="sorting_asc" tabindex="0" aria-controls="editable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending" style="width: 159px;">用户编码</th>
                                    <th class="sorting" tabindex="0" aria-controls="editable" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending" style="width: 200px;">用户名称</th>
                                    <th class="sorting" tabindex="0" aria-controls="editable" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending" style="width: 180px;">用户角色</th>
                                    <th class="sorting" tabindex="0" aria-controls="editable" rowspan="1" colspan="1" aria-label="Engine version: activate to sort column ascending" style="width: 136px;">所属部门</th>
                                    <th class="sorting" tabindex="0" aria-controls="editable" rowspan="1" colspan="1" aria-label="CSS grade: activate to sort column ascending" style="width: 95px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                               
                                @for (int i = 0; i < Model.Count(); i++)
                                {

                                    <tr class="gradeA @(i % 2 != 0 ? "odd" : "even")" role="row">
                                      
                                        <td class="sorting_1">@(Model.ToList()[i].ID)</td>
                                        <td>@(Model.ToList()[i].Username)</td>
                                        <td id="@(Model.ToList()[i].RID)">@(Model.ToList()[i].Roleinfo.Rolename)</td>
                                        <td class="center" id="@(Model.ToList()[i].DID)">@(Model.ToList()[i].Department.Dname)</td>
                                        <td class="text-left footable-visible footable-last-column">
                                            <div class="btn-group">
                                                <a href="/Page2/UserView/@(Model.ToList()[i].ID)" class="btn-white btn btn-xs">View</a>
                                                <a href="/Page2/UserEdit/@(Model.ToList()[i].ID)" class="btn-white btn btn-xs">Edit</a>
                                                <a class="demo3 btn-white btn btn-xs" id="@(Model.ToList()[i].ID)">Delete</a>
                                            </div>
                                        </td>
                                    </tr>

                                }
                            </tbody>

                        </table>
                    </div>
                </div><div class="row"><div class="col-sm-5"><div class="dataTables_info" id="editable_info" role="status" aria-live="polite">Showing 1 to 10 of 57 entries</div></div><div class="col-sm-7"><div class="dataTables_paginate paging_simple_numbers" id="editable_paginate"><ul class="pagination"><li class="paginate_button previous disabled" id="editable_previous"><a href="#" aria-controls="editable" data-dt-idx="0" tabindex="0">Previous</a></li><li class="paginate_button active"><a href="#" aria-controls="editable" data-dt-idx="1" tabindex="0">1</a></li><li class="paginate_button "><a href="#" aria-controls="editable" data-dt-idx="2" tabindex="0">2</a></li><li class="paginate_button "><a href="#" aria-controls="editable" data-dt-idx="3" tabindex="0">3</a></li><li class="paginate_button "><a href="#" aria-controls="editable" data-dt-idx="4" tabindex="0">4</a></li><li class="paginate_button "><a href="#" aria-controls="editable" data-dt-idx="5" tabindex="0">5</a></li><li class="paginate_button "><a href="#" aria-controls="editable" data-dt-idx="6" tabindex="0">6</a></li><li class="paginate_button next" id="editable_next"><a href="#" aria-controls="editable" data-dt-idx="7" tabindex="0">Next</a></li></ul></div></div></div>
            </div>

        </div>
    </div>
</div>
}
<script>
    $('.demo3').click(function () {
        let id = $(this).attr("id")
        alert(id)
        swal({
            title: "确认要删除吗?",
            text: "您将要删除此条信息!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "是的, 删除它!",
            closeOnConfirm: false
        }, function () {

            axios.post('/Page2/deleteUser/' + id + '').then(res => {
                console.log(res);

            })
            swal("已删除!", "您的此条记录已被删除.", "success");

            window.location.href="UsersList"
        });
    });
    function iop() {
       
        let name = $("#exampleInputName2").val();
        let Rname = $("#RID").val();
        let Dname = $("#DID").val();
        $(".gradeA").each(function () {
            $(this).hide()
            
            let str = $(this).children("td:eq(1)").html();     


            if (str.indexOf(name) == -1) {

                return;
            }
            

            str = $(this).children("td:eq(2)").attr("id")

            if (Rname != "00000000-0000-0000-0000-000000000000") {
                if (str != Rname) {

                    return
                }
            }

            str = $(this).children("td:eq(3)").attr("id")
           
            if (Dname != "00000000-0000-0000-0000-000000000000") {
                if (str != Dname) {

                    return
                }
            }
            $(this).show()
           

        })

    }

</script>
